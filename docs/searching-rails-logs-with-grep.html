<!DOCTYPE html>
<html>
  <head>
    <title>Page Title</title>
  </head>
  <body>
    <h1>Searching Rails Logs with Grep</h1>
<p>04-04-2021</p>

<p>Rails logs can contain a lot of output so finding what you're looking for can be troublesome at times. Here are a few tricks for quickly finding what you need, from printing out a single line to multiple lines and their surrounding context.</p>

<h2>Just grep</h2>

<p>Return all occurrences of a string (I will be using &#39;appsignal&#39; as an example) from the log.</p>

<p><code>bash
grep appsignal log/production.log
</code></p>

<h2>Return the first n matches</h2>

<p>Very similar to the first command but pass the  <code>-m</code> (max count) option to limit the number of results returned.</p>

<p><code>bash
grep -m 5 appsignal log/production.log
</code></p>

<h2>Return n lines before/after the match</h2>

<p>Returning a single line from a log without any of the logs that occured before or after it isn&#39;t particularly useful. Thankfully you can pass the <code>-A</code> or <code>-B</code> options with a number as an argument to also print the lines above or below the matching string. Passing <code>-A 10</code> will print the matching line as well as the 10 lines preceeding it.</p>

<p><code>bash
grep -A 10 appsignal log/production.log
</code></p>

<p>While passing <code>-B 10</code> will print the matching line as well as the 10 lines after it.</p>

<p><code>bash
grep -B 10 appsignal log/production.log
</code></p>

<p>A shortcut to returning the lines both above and below is to use the <code>-C</code> (context) option which will return both the preceeding and subsequent lines following a match.</p>

<p><code>bash
grep -C 10 appsignal log/production.log
</code></p>

<h2>Search from the bottom of the file</h2>

<p>You may have noticed that the <code>man</code> command defaults to searching from the top of the file, this is not ideal if you want to print out the occurrences of a match that were logged most recently to your file. A quick and easy way to find the most recent matches is essentially to reverse the file and then search through the result. The <code>cat</code> command will dump the contents of your file to STDOUT and the <code>tac</code> command will do exactly the same but from the bottom! We can then pipe this output to <code>grep</code> and search it as we would in the previous examples.</p>

<p>To find the most recent log of your match (appsignal) and display the 5 lines above and below it you can use the following command.</p>

<p><code>bash
tac log/production.log | grep -m 1 -C 5 appsignal
</code></p>

<p>There are most certainly other ways to do this but I have found this solution to be simple and reliable. I hope it can be useful to you too. Please do drop me a message on <a href="https://twitter.com/lewisyoul">twitter</a> if you have any different or better mechanisms for searching logs!</p>

  </body>
</html>